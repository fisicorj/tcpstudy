<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treinador de Montagem de Cabo de Rede - Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        :root {
            --primary-color: #3b82f6;
            --success-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #e5e7eb 0%, #6b7280 100%);
            min-height: 100vh;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .wire {
            width: 32px;
            height: 130px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: grab;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 5px;
            color: transparent;
            font-size: 0.7rem;
            font-weight: 600;
            background-size: 10px 10px;
            position: relative;
            user-select: none;
        }
        
        .wire:focus {
            outline: 3px solid var(--primary-color);
            outline-offset: 2px;
        }
        
        .wire.solid-color {
            background-image: none;
        }
        
        .wire.striped-color {
            background-image: linear-gradient(45deg, 
                rgba(255, 255, 255, 0.6) 25%, 
                transparent 25%, 
                transparent 50%, 
                rgba(255, 255, 255, 0.6) 50%, 
                rgba(255, 255, 255, 0.6) 75%, 
                transparent 75%, 
                transparent);
        }
        
        .wire:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.25);
            z-index: 10;
        }
        
        .wire.dragging {
            cursor: grabbing;
            opacity: 0.8;
            transform: rotate(5deg) scale(1.1);
            z-index: 1000;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            animation: pulse 1s infinite;
        }
        
        .wire.tutorial-highlight {
            animation: glow 2s infinite;
            box-shadow: 0 0 20px var(--warning-color);
        }
        
        @keyframes pulse {
            0%, 100% { transform: rotate(5deg) scale(1.1); }
            50% { transform: rotate(5deg) scale(1.15); }
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 10px var(--warning-color); }
            50% { box-shadow: 0 0 25px var(--warning-color), 0 0 35px var(--warning-color); }
        }
        
        @keyframes correctWire {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .wire-placeholder {
            width: 32px;
            height: 130px;
            border: 2px dashed #9ca3af;
            border-radius: 8px;
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 5px;
            box-sizing: border-box;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .wire-placeholder.correct {
            border-color: var(--success-color);
            background-color: rgba(16, 185, 129, 0.1);
            animation: correctWire 0.6s ease-out;
        }
        
        .wire-placeholder.incorrect {
            border-color: var(--error-color);
            background-color: rgba(239, 68, 68, 0.1);
            animation: shake 0.5s ease-out;
        }
        
        .wire-placeholder.tutorial-target {
            border-color: var(--warning-color);
            background-color: rgba(245, 158, 11, 0.2);
            animation: targetPulse 1.5s infinite;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        @keyframes targetPulse {
            0%, 100% { transform: scale(1); border-width: 2px; }
            50% { transform: scale(1.05); border-width: 3px; }
        }
        
        .wire-placeholder .slot-number {
            position: absolute;
            top: 5px;
            color: #6b7280;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .drop-highlight {
            border: 3px solid var(--primary-color);
            background: linear-gradient(45deg, rgba(59, 130, 246, 0.1), rgba(59, 130, 246, 0.2));
            transform: scale(1.05);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            font-weight: 700;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            font-weight: 700;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
            font-weight: 700;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .stats-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 1rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        
        .difficulty-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .difficulty-btn {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: 2px solid transparent;
            background: rgba(255, 255, 255, 0.1);
            color: #4b5563;
            transition: all 0.3s ease;
            cursor: pointer;
            font-weight: 600;
        }
        
        .difficulty-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .message-box {
            animation: slideInDown 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            border-radius: 50px;
        }
        
        @keyframes slideInDown {
            0% {
                opacity: 0;
                transform: translateY(-30px) scale(0.8);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), var(--primary-color));
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.875rem;
            pointer-events: none;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
            max-width: 200px;
        }
        
        .tooltip.show {
            opacity: 1;
            transform: translateY(-5px);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: white;
            padding: 2.5rem;
            border-radius: 20px;
            max-width: 95%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            animation: slideInUp 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            z-index: 3000;
            pointer-events: none;
            animation: celebrate 2s ease-out;
        }
        
        @keyframes celebrate {
            0% { 
                opacity: 0; 
                transform: translate(-50%, -50%) scale(0) rotate(0deg); 
            }
            50% { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1.2) rotate(180deg); 
            }
            100% { 
                opacity: 0; 
                transform: translate(-50%, -50%) scale(1) rotate(360deg); 
            }
        }
        
        .sound-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }
        
        .sound-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }
        
        @media (max-width: 768px) {
            .wire {
                width: 28px;
                height: 110px;
            }
            .wire-placeholder {
                width: 28px;
                height: 110px;
            }
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <!-- Botão de Som -->
    <button id="sound-toggle" class="sound-toggle" title="Alternar Som">
        <i class="fas fa-volume-up text-gray-700"></i>
    </button>

    <div class="glass-effect p-8 rounded-3xl shadow-2xl max-w-6xl w-full text-center">
        <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 mb-2">
            <i class="fas fa-network-wired mr-3 text-blue-600"></i>
            Treinador de Montagem de Cabo
        </h1>
        <p class="text-lg text-gray-600 mb-6">Pratique a montagem de cabos de rede com precisão profissional!</p>
        
        <!-- Seletor de padrão e modo tutorial -->
        <div class="flex flex-col sm:flex-row justify-center items-center gap-4 mb-6">
            <div class="flex items-center gap-3">
                <label for="pattern-select" class="text-gray-700 font-semibold">Padrão:</label>
                <select id="pattern-select" class="p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition-all bg-white">
                    <option value="568A">Padrão 568A</option>
                    <option value="568B" selected>Padrão 568B</option>
                    <option value="Crossover">Crossover</option>
                    <option value="Crossover1000">Crossover (1000BASE-T)</option>
                </select>
            </div>
            <button id="tutorial-btn" class="btn-primary px-4 py-2 rounded-lg">
                <i class="fas fa-graduation-cap mr-2"></i>Modo Tutorial
            </button>
        </div>

        <!-- Referência visual e dicas -->
        <div class="flex justify-center gap-4 mb-6">
            <button id="show-ref-btn" class="text-blue-600 hover:text-blue-800 transition-colors font-semibold">
                <i class="fas fa-eye mr-1"></i> Ver Referência
            </button>
            <button id="hint-btn" class="text-green-600 hover:text-green-800 transition-colors font-semibold">
                <i class="fas fa-lightbulb mr-1"></i> Dica
            </button>
        </div>

        <!-- Mensagens de status -->
        <div id="message-container" class="mb-6 h-16 flex justify-center items-center"></div>
        
        <!-- Contêiner dos fios disponíveis -->
        <div id="wires-container" class="flex flex-wrap justify-center gap-4 mb-8 p-4 bg-gray-50 rounded-2xl min-h-[160px]">
            <!-- Fios serão injetados aqui via JS -->
        </div>

        <!-- Contêineres dos conectores -->
        <div id="connector-group" class="flex flex-col items-center gap-6">
            <div class="flex flex-col items-center">
                <div id="connector-container-1" class="flex flex-wrap justify-center gap-2 bg-gray-200 p-6 rounded-xl shadow-inner">
                    <!-- Slots dos fios serão injetados aqui via JS -->
                </div>
                <div id="connector-label-1" class="text-sm text-gray-600 mt-3 font-semibold">Conector RJ45</div>
            </div>
            
            <div id="connector-2-group" class="flex flex-col items-center hidden">
                <div id="connector-container-2" class="flex flex-wrap justify-center gap-2 bg-gray-200 p-6 rounded-xl shadow-inner">
                    <!-- Slots da segunda ponta do cabo crossover -->
                </div>
                <div id="connector-label-2" class="text-sm text-gray-600 mt-3 font-semibold"></div>
            </div>
        </div>
        
        <!-- Botões de ação -->
        <div class="flex flex-col sm:flex-row justify-center gap-4 mt-8">
            <button id="reset-btn" class="btn-danger px-8 py-3 rounded-xl flex items-center justify-center transition-all">
                <i class="fas fa-redo-alt mr-2"></i> Reiniciar
            </button>
        </div>
    </div>

    <!-- Modal de Referência -->
    <div id="reference-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="close-modal-btn" class="absolute top-4 right-4 text-2xl text-gray-500 hover:text-gray-700 transition-colors">
                <i class="fas fa-times"></i>
            </button>
            <h2 class="text-3xl font-bold mb-6 text-center text-gray-800">
                <i class="fas fa-book mr-3 text-blue-600"></i>
                Guia de Referência
            </h2>
            <p class="text-gray-600 mb-8 text-center">Consulte os padrões oficiais de montagem de cabos de rede</p>

            <div class="grid gap-8">
                <!-- Diagrama 568A -->
                <div class="text-center">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Padrão TIA/EIA 568A</h3>
                    <div id="ref-568A" class="flex justify-center gap-1 mb-2"></div>
                    <p class="text-sm text-gray-600">Usado principalmente em instalações residenciais</p>
                </div>

                <!-- Diagrama 568B -->
                <div class="text-center">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Padrão TIA/EIA 568B</h3>
                    <div id="ref-568B" class="flex justify-center gap-1 mb-2"></div>
                    <p class="text-sm text-gray-600">Mais comum em instalações comerciais</p>
                </div>

                <!-- Diagrama Crossover -->
                <div class="text-center">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Cabo Crossover (10/100 Mbps)</h3>
                    <div class="flex justify-center gap-8">
                        <div class="text-center">
                            <div id="ref-crossover-a" class="flex justify-center gap-1 mb-2"></div>
                            <span class="text-sm text-gray-600">Ponta 568A</span>
                        </div>
                        <div class="text-center">
                            <div id="ref-crossover-b" class="flex justify-center gap-1 mb-2"></div>
                            <span class="text-sm text-gray-600">Ponta 568B</span>
                        </div>
                    </div>
                    <p class="text-sm text-gray-600">Para conexão direta entre dispositivos similares</p>
                </div>

                <!-- Diagrama Crossover 1000BASE-T -->
                <div class="text-center">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Cabo Crossover (1000BASE-T)</h3>
                    <div class="flex justify-center gap-8">
                        <div class="text-center">
                            <div id="ref-crossover-1000-a" class="flex justify-center gap-1 mb-2"></div>
                            <span class="text-sm text-gray-600">Ponta 1</span>
                        </div>
                        <div class="text-center">
                            <div id="ref-crossover-1000-b" class="flex justify-center gap-1 mb-2"></div>
                            <span class="text-sm text-gray-600">Ponta 2</span>
                        </div>
                    </div>
                    <p class="text-sm text-gray-600">Para Gigabit Ethernet - todos os pares são utilizados</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Tooltip -->
    <div id="tooltip" class="tooltip"></div>

    <script type="module">
        // Classe principal para gerenciar toda a lógica do jogo
        class CableTrainer {
            constructor() {
                // Definições de cores e padrões
                this.wires = [
                    { id: 'bw-green', color: '#68D391', name: 'Branco-Verde', code: 'w-green' },
                    { id: 'green', color: '#38A169', name: 'Verde', code: 'green' },
                    { id: 'bw-orange', color: '#F6AD55', name: 'Branco-Laranja', code: 'w-orange' },
                    { id: 'orange', color: '#DD6B20', name: 'Laranja', code: 'orange' },
                    { id: 'bw-blue', color: '#63B3ED', name: 'Branco-Azul', code: 'w-blue' },
                    { id: 'blue', color: '#4299E1', name: 'Azul', code: 'blue' },
                    { id: 'bw-brown', color: '#B7791F', name: 'Branco-Marrom', code: 'w-brown' },
                    { id: 'brown', color: '#9B5A03', name: 'Marrom', code: 'brown' },
                ];
                this.patterns = {
                    '568A': ['w-green', 'green', 'w-orange', 'blue', 'w-blue', 'orange', 'w-brown', 'brown'],
                    '568B': ['w-orange', 'orange', 'w-green', 'blue', 'w-blue', 'green', 'w-brown', 'brown'],
                    'Crossover': {
                        'endA': ['w-green', 'green', 'w-orange', 'blue', 'w-blue', 'orange', 'w-brown', 'brown'],
                        'endB': ['w-orange', 'orange', 'w-green', 'blue', 'w-blue', 'green', 'w-brown', 'brown']
                    },
                    'Crossover1000': {
                        'endA': ['w-orange', 'orange', 'w-green', 'blue', 'w-blue', 'green', 'w-brown', 'brown'],
                        'endB': ['w-green', 'green', 'w-orange', 'blue', 'w-blue', 'orange', 'w-brown', 'brown']
                    }
                };
                this.hintsData = {
                    '568B': "Lembre-se: Laranja primeiro! O padrão 568B é mais comum em instalações comerciais.",
                    '568A': "Verde primeiro no 568A. Este padrão é menos comum mas ainda usado.",
                    'Crossover': "Para crossover 10/100, apenas os pares 1-2 e 3-6 são trocados.",
                    'Crossover1000': "Para Gigabit, todos os 4 pares são utilizados. Os pares 1-2, 3-6, 4-5 e 7-8 são trocados."
                };
                this.wireMap = {};
                this.wires.forEach(wire => this.wireMap[wire.code] = wire);

                // Estado do jogo
                this.gameState = {
                    currentPattern: '568B',
                    attempts: 0,
                    isTutorialMode: false,
                    tutorialStep: 0,
                    correctSequence: []
                };

                // Referências DOM
                this.elements = {
                    wiresContainer: document.getElementById('wires-container'),
                    connectorContainer1: document.getElementById('connector-container-1'),
                    connectorContainer2: document.getElementById('connector-container-2'),
                    connectorLabel1: document.getElementById('connector-label-1'),
                    connectorLabel2: document.getElementById('connector-label-2'),
                    patternSelect: document.getElementById('pattern-select'),
                    resetBtn: document.getElementById('reset-btn'),
                    hintBtn: document.getElementById('hint-btn'),
                    tutorialBtn: document.getElementById('tutorial-btn'),
                    messageContainer: document.getElementById('message-container'),
                    attemptCounter: document.getElementById('attempt-counter'),
                    showRefBtn: document.getElementById('show-ref-btn'),
                    referenceModal: document.getElementById('reference-modal'),
                    closeModalBtn: document.getElementById('close-modal-btn'),
                    ref568AContainer: document.getElementById('ref-568A'),
                    ref568BContainer: document.getElementById('ref-568B'),
                    refCrossoverAContainer: document.getElementById('ref-crossover-a'),
                    refCrossoverBContainer: document.getElementById('ref-crossover-b'),
                    refCrossover1000AContainer: document.getElementById('ref-crossover-1000-a'),
                    refCrossover1000BContainer: document.getElementById('ref-crossover-1000-b')
                };
                
                this.draggedWire = null;

                // Inicializa o jogo
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.renderUI();
                this.renderReferenceDiagrams();
            }

            setupEventListeners() {
                document.addEventListener('dragstart', this.handleDragStart.bind(this));
                document.addEventListener('dragend', this.handleDragEnd.bind(this));
                document.addEventListener('dragover', this.handleDragOver.bind(this));
                document.addEventListener('drop', this.handleDrop.bind(this));
                document.addEventListener('dragenter', this.handleDragEnter.bind(this));
                document.addEventListener('dragleave', this.handleDragLeave.bind(this));
                
                this.elements.patternSelect.addEventListener('change', this.handlePatternChange.bind(this));
                this.elements.resetBtn.addEventListener('click', this.handleResetClick.bind(this));
                this.elements.showRefBtn.addEventListener('click', this.handleShowRefClick.bind(this));
                this.elements.closeModalBtn.addEventListener('click', this.handleCloseModalClick.bind(this));
                this.elements.hintBtn.addEventListener('click', this.handleHintClick.bind(this));
                this.elements.tutorialBtn.addEventListener('click', this.toggleTutorialMode.bind(this));
            }
            
            // Lógica de drag and drop
            handleDragStart(e) {
                if (e.target.classList.contains('wire')) {
                    this.draggedWire = e.target;
                    e.dataTransfer.setData('text/plain', e.target.dataset.code);
                    setTimeout(() => e.target.classList.add('dragging'), 0);
                }
            }

            handleDragEnd(e) {
                if (e.target.classList.contains('wire')) {
                    e.target.classList.remove('dragging');
                    this.draggedWire = null;
                }
            }

            handleDragOver(e) {
                e.preventDefault();
                const validDropTarget = e.target.closest('#wires-container') || e.target.closest('.wire-placeholder');
                if (validDropTarget) {
                    e.dataTransfer.dropEffect = 'move';
                }
            }

            handleDrop(e) {
                e.preventDefault();
                const target = e.target.closest('.wire-placeholder') || e.target.closest('#wires-container');

                if (this.draggedWire && target) {
                    // Se estiver no modo tutorial, impede que o fio seja solto no lugar errado
                    if(this.gameState.isTutorialMode) {
                        const correctCode = this.gameState.correctSequence[this.gameState.tutorialStep];
                        let targetSlot = null;
                        if(this.gameState.tutorialStep < 8) {
                            targetSlot = this.elements.connectorContainer1.children[this.gameState.tutorialStep];
                        } else {
                            targetSlot = this.elements.connectorContainer2.children[this.gameState.tutorialStep - 8];
                        }

                        if (this.draggedWire.dataset.code !== correctCode || target !== targetSlot) {
                            this.showMessage('No Modo Tutorial, arraste o fio e o slot destacados!', 'error');
                            return;
                        }
                    }

                    const parentSlot = this.draggedWire.parentNode;
                    if(parentSlot && parentSlot.classList.contains('wire-placeholder')) {
                        parentSlot.classList.remove('correct', 'incorrect');
                    }

                    if (target.classList.contains('wire-placeholder') && target.querySelector('.wire')) {
                        const existingWire = target.querySelector('.wire');
                        const originalParent = this.draggedWire.parentNode;
                        
                        if (originalParent) {
                            originalParent.appendChild(existingWire);
                        }
                        target.appendChild(this.draggedWire);
                    } else {
                        target.appendChild(this.draggedWire);
                    }
                    this.validateCurrentState();
                }
            }

            handleDragEnter(e) {
                e.preventDefault();
                const target = e.target.closest('.wire-placeholder');
                if (target && !target.querySelector('.wire')) {
                    target.classList.add('drop-highlight');
                }
            }

            handleDragLeave(e) {
                const target = e.target.closest('.wire-placeholder');
                if (target) {
                    target.classList.remove('drop-highlight');
                }
            }
            
            // Lógica do jogo
            handlePatternChange(e) {
                this.gameState.currentPattern = e.target.value;
                this.renderUI();
            }

            handleResetClick() {
                this.renderUI();
            }

            handleShowRefClick(e) {
                e.preventDefault();
                this.elements.referenceModal.style.display = 'flex';
            }

            handleCloseModalClick() {
                this.elements.referenceModal.style.display = 'none';
            }

            handleHintClick() {
                if (this.gameState.isTutorialMode) {
                    this.showMessage('O modo tutorial já está te guiando!', 'warning');
                    return;
                }
                const hintText = this.hintsData[this.gameState.currentPattern];
                this.showMessage(hintText, 'warning');
            }

            toggleTutorialMode() {
                this.gameState.isTutorialMode = !this.gameState.isTutorialMode;
                this.elements.tutorialBtn.textContent = this.gameState.isTutorialMode ? "Sair do Tutorial" : "Modo Tutorial";
                this.renderUI();
            }

            shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[i], newArray[j]];
                }
                return newArray;
            }

            createWireElement(wire) {
                const wireDiv = document.createElement('div');
                wireDiv.classList.add('wire', 'rounded-lg', 'flex-shrink-0');
                wireDiv.style.backgroundColor = wire.color;
                wireDiv.dataset.code = wire.code;
                wireDiv.setAttribute('draggable', true);
                wireDiv.setAttribute('tabindex', '0');
                wireDiv.setAttribute('role', 'button');
                wireDiv.id = `wire-${wire.id}-${Math.random().toString(36).substring(2, 8)}`;
                wireDiv.title = wire.name; // Adiciona o tooltip com o nome do fio
                if (wire.id.startsWith('bw-')) {
                    wireDiv.classList.add('striped-color');
                } else {
                    wireDiv.classList.add('solid-color');
                }
                return wireDiv;
            }

            createPlaceholderElement(index) {
                const placeholderDiv = document.createElement('div');
                placeholderDiv.classList.add('wire-placeholder', 'rounded-lg');
                placeholderDiv.dataset.index = index;
                const slotNumber = document.createElement('span');
                slotNumber.classList.add('slot-number');
                slotNumber.textContent = index + 1;
                placeholderDiv.appendChild(slotNumber);
                return placeholderDiv;
            }

            renderUI() {
                this.elements.wiresContainer.innerHTML = '';
                this.elements.connectorContainer1.innerHTML = '';
                if(this.elements.connectorContainer2) this.elements.connectorContainer2.innerHTML = '';
                this.elements.messageContainer.innerHTML = '';
                
                this.gameState.attempts = 0;
                if (this.elements.attemptCounter) {
                    this.elements.attemptCounter.querySelector('span').textContent = `Tentativas: ${this.gameState.attempts}`;
                }
                
                const isCrossoverMode = this.elements.patternSelect.value === 'Crossover' || this.elements.patternSelect.value === 'Crossover1000';
                const totalWires = isCrossoverMode ? 16 : 8;
                
                const wirePool = [];
                for (let i = 0; i < totalWires / 8; i++) {
                    this.wires.forEach(wire => wirePool.push(wire));
                }
                const shuffledWires = this.shuffleArray(wirePool);
                shuffledWires.forEach(wire => this.elements.wiresContainer.appendChild(this.createWireElement(wire)));
                
                for (let i = 0; i < 8; i++) {
                    this.elements.connectorContainer1.appendChild(this.createPlaceholderElement(i));
                }
                
                const connector2Group = document.getElementById('connector-2-group');
                if (isCrossoverMode) {
                    if(connector2Group) connector2Group.classList.remove('hidden');
                    if(this.elements.connectorLabel1) this.elements.connectorLabel1.textContent = 'Ponta A';
                    if(this.elements.connectorLabel2) this.elements.connectorLabel2.textContent = 'Ponta B';
                    if(this.elements.connectorContainer2) {
                        for (let i = 0; i < 8; i++) {
                            this.elements.connectorContainer2.appendChild(this.createPlaceholderElement(i));
                        }
                    }
                } else {
                    if(connector2Group) connector2Group.classList.add('hidden');
                    if(this.elements.connectorLabel1) this.elements.connectorLabel1.textContent = 'Conector RJ45 (vista superior, da esquerda para a direita)';
                }
                
                this.validateCurrentState();

                // Lógica do tutorial
                if (this.gameState.isTutorialMode) {
                    const correctSeq = isCrossoverMode ? this.patterns[this.gameState.currentPattern].endA.concat(this.patterns[this.gameState.currentPattern].endB) : this.patterns[this.gameState.currentPattern];
                    this.gameState.correctSequence = correctSeq;
                    this.gameState.tutorialStep = 0;
                    this.highlightTutorialStep();
                }
            }

            renderReferenceDiagrams() {
                if(this.elements.ref568AContainer) this.elements.ref568AContainer.innerHTML = '';
                if(this.elements.ref568BContainer) this.elements.ref568BContainer.innerHTML = '';
                if(this.elements.refCrossoverAContainer) this.elements.refCrossoverAContainer.innerHTML = '';
                if(this.elements.refCrossoverBContainer) this.elements.refCrossoverBContainer.innerHTML = '';
                if(this.elements.refCrossover1000AContainer) this.elements.refCrossover1000AContainer.innerHTML = '';
                if(this.elements.refCrossover1000BContainer) this.elements.refCrossover1000BContainer.innerHTML = '';

                this.patterns['568A'].forEach(wireCode => {
                    if (this.elements.ref568AContainer) {
                        this.elements.ref568AContainer.appendChild(this.createRefWireElement(wireCode));
                    }
                });
                this.patterns['568B'].forEach(wireCode => {
                    if (this.elements.ref568BContainer) {
                        this.elements.ref568BContainer.appendChild(this.createRefWireElement(wireCode));
                    }
                });
                
                if (this.patterns['Crossover'] && this.patterns['Crossover'].endA && this.elements.refCrossoverAContainer) {
                    this.patterns['Crossover'].endA.forEach(wireCode => this.elements.refCrossoverAContainer.appendChild(this.createRefWireElement(wireCode)));
                }
                if (this.patterns['Crossover'] && this.patterns['Crossover'].endB && this.elements.refCrossoverBContainer) {
                    this.patterns['Crossover'].endB.forEach(wireCode => this.elements.refCrossoverBContainer.appendChild(this.createRefWireElement(wireCode)));
                }

                if (this.patterns['Crossover1000'] && this.patterns['Crossover1000'].endA && this.elements.refCrossover1000AContainer) {
                    this.patterns['Crossover1000'].endA.forEach(wireCode => this.elements.refCrossover1000AContainer.appendChild(this.createRefWireElement(wireCode)));
                }
                if (this.patterns['Crossover1000'] && this.patterns['Crossover1000'].endB && this.elements.refCrossover1000BContainer) {
                    this.patterns['Crossover1000'].endB.forEach(wireCode => this.elements.refCrossover1000BContainer.appendChild(this.createRefWireElement(wireCode)));
                }
            }

            createRefWireElement(wireCode) {
                const wire = this.wireMap[wireCode];
                if (!wire) return null; // Adiciona uma verificação para evitar o erro

                const wireDiv = document.createElement('div');
                wireDiv.classList.add('ref-wire', 'rounded-lg', 'flex-shrink-0');
                wireDiv.style.backgroundColor = wire.color;
                if (wire.id.startsWith('bw-')) {
                    wireDiv.classList.add('striped-color');
                } else {
                    wireDiv.classList.add('solid-color');
                }
                return wireDiv;
            }

            highlightTutorialStep() {
                const isCrossoverMode = this.gameState.currentPattern === 'Crossover' || this.gameState.currentPattern === 'Crossover1000';
                const correctCode = this.gameState.correctSequence[this.gameState.tutorialStep];
                if (!correctCode) {
                    this.showMessage('Tutorial completo!', 'success');
                    this.gameState.isTutorialMode = false;
                    this.elements.tutorialBtn.textContent = "Modo Tutorial";
                    this.clearHighlights();
                    return;
                }

                const correctWire = this.elements.wiresContainer.querySelector(`[data-code="${correctCode}"]`);
                this.clearHighlights();
                if (correctWire) {
                    correctWire.classList.add('tutorial-highlight');
                }

                const targetSlotIndex = this.gameState.tutorialStep;
                let targetSlot;
                if (isCrossoverMode && targetSlotIndex >= 8) {
                    targetSlot = this.elements.connectorContainer2.children[targetSlotIndex - 8];
                } else {
                    targetSlot = this.elements.connectorContainer1.children[targetSlotIndex];
                }

                if (targetSlot) {
                    targetSlot.classList.add('tutorial-target');
                }
            }

            clearHighlights() {
                this.elements.wiresContainer.querySelectorAll('.tutorial-highlight').forEach(el => el.classList.remove('tutorial-highlight'));
                this.elements.connectorContainer1.querySelectorAll('.tutorial-target').forEach(el => el.classList.remove('tutorial-target'));
                if (this.elements.connectorContainer2) {
                    this.elements.connectorContainer2.querySelectorAll('.tutorial-target').forEach(el => el.classList.remove('tutorial-target'));
                }
            }
            
            validateCurrentState(isFinalCheck = false) {
                if(this.gameState.isTutorialMode) {
                    const isCrossoverMode = this.gameState.currentPattern === 'Crossover' || this.gameState.currentPattern === 'Crossover1000';
                    const currentSlot = this.gameState.tutorialStep < 8 ? this.elements.connectorContainer1.children[this.gameState.tutorialStep] : (this.elements.connectorContainer2 ? this.elements.connectorContainer2.children[this.gameState.tutorialStep - 8] : null);
                    const wireInSlot = currentSlot ? currentSlot.querySelector('.wire') : null;
                    const correctCode = this.gameState.correctSequence[this.gameState.tutorialStep];
                    
                    if(wireInSlot && wireInSlot.dataset.code === correctCode) {
                        this.gameState.tutorialStep++;
                        this.highlightTutorialStep();
                        if (this.gameState.tutorialStep < this.gameState.correctSequence.length) {
                           this.showMessage('Correto! Próximo fio...', 'success');
                        }
                    } else if (wireInSlot && wireInSlot.dataset.code !== correctCode) {
                        this.showMessage('Fio incorreto. Tente novamente.', 'error');
                    }
                    return;
                }

                const isCrossoverMode = this.gameState.currentPattern === 'Crossover' || this.gameState.currentPattern === 'Crossover1000';
                
                const sequences = [
                    Array.from(this.elements.connectorContainer1.children).map(slot => slot.querySelector('.wire') ? slot.querySelector('.wire').dataset.code : null),
                    ...(isCrossoverMode && this.elements.connectorContainer2 ? [Array.from(this.elements.connectorContainer2.children).map(slot => slot.querySelector('.wire') ? slot.querySelector('.wire').dataset.code : null)] : [])
                ];

                const correctSequences = isCrossoverMode ? this.patterns[this.gameState.currentPattern] : [this.patterns[this.gameState.currentPattern]];
                let allFilled = true;
                let allCorrect = true;

                [this.elements.connectorContainer1, this.elements.connectorContainer2].forEach((container, containerIndex) => {
                    if (!container || container.classList.contains('hidden')) return;

                    const currentSeq = sequences[containerIndex];
                    const correctSeq = correctSequences[isCrossoverMode ? (containerIndex === 0 ? 'endA' : 'endB') : 0];

                    if (container) {
                        Array.from(container.children).forEach((slot, i) => {
                            const wireCode = currentSeq[i];
                            if (!wireCode) {
                                allFilled = false;
                                slot.classList.remove('correct', 'incorrect');
                            } else if (wireCode === correctSeq[i]) {
                                slot.classList.add('correct');
                                slot.classList.remove('incorrect');
                            } else {
                                slot.classList.add('incorrect');
                                slot.classList.remove('correct');
                                allCorrect = false;
                            }
                        });
                    }
                });

                if (allFilled) {
                    if (allCorrect) {
                        this.showMessage('Parabéns! A sequência está correta!', 'success');
                    } else {
                        this.showMessage('Sequência incorreta. Continue tentando.', 'error');
                    }
                } else {
                    this.elements.messageContainer.innerHTML = '';
                }
            }

            showMessage(text, type) {
                let bgColor = '';
                let icon = '';
                if (type === 'success') {
                    bgColor = 'bg-green-500';
                    icon = '<i class="fas fa-check-circle mr-2"></i>';
                } else if (type === 'error') {
                    bgColor = 'bg-red-500';
                    icon = '<i class="fas fa-times-circle mr-2"></i>';
                } else if (type === 'warning') {
                    bgColor = 'bg-yellow-500';
                    icon = '<i class="fas fa-exclamation-triangle mr-2"></i>';
                }
                
                this.elements.messageContainer.innerHTML = '';
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message-box', 'px-6', 'py-3', 'rounded-full', bgColor, 'text-white', 'font-semibold', 'flex', 'items-center');
                messageDiv.innerHTML = `${icon} ${text}`;
                this.elements.messageContainer.appendChild(messageDiv);
            }
        }

        document.addEventListener('DOMContentLoaded', () => new CableTrainer());
    </script>
</body>
</html>